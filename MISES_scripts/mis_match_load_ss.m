% filename = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade','M080SC100d3_no_hade','M080SC100d4_no_hade','M080SC100d6_no_hade','M075SC1007_no_hade','M075SC1008_no_hade','M090SC100g_no_hade2','M090SC100g_no_hade3','M080SC100l_no_hade','M080SC100m_no_hade','M080SC100n_no_hade','M080SC100p_no_hade'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade','M080SC100d3_no_hade','M080SC100d4_no_hade','M080SC100d6_no_hade','M075SC1007_no_hade','M075SC1008_no_hade','M090SC100g_no_hade2','M090SC100g_no_hade3','M080SC100l_no_hade','M080SC100m_no_hade','M080SC100n_no_hade','M080SC100p_no_hade'};

% filename = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade','M080SC100d3_no_hade','M080SC100d4_no_hade','M080SC100d6_no_hade','M075SC1007_no_hade','M075SC1008_no_hade','M090SC100g_no_hade2','M090SC100g_no_hade3','M080SC100l_no_hade','M080SC100m_no_hade','M080SC100n_no_hade','M080SC100p_no_hade'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade','M080SC100d3_no_hade','M080SC100d4_no_hade','M080SC100d6_no_hade','M075SC1007_no_hade','M075SC1008_no_hade','M090SC100g_no_hade2','M090SC100g_no_hade3','M080SC100l_no_hade','M080SC100m_no_hade','M080SC100n_no_hade','M080SC100p_no_hade'};

% filename = {'M090SC100a_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100i_no_hade'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M090SC100a_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100i_no_hade'};

filename = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade'};
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = {'M090SC100j_no_hade','M090SC100i_no_hade','M090SC100a_no_hade','M090SC100e_no_hade','M090SC100g_no_hade','M090SC100d_no_hade','M090SC100h_no_hade'};

filename = {'M090SC90j_no_hade_load_coef','M090SC90i_no_hade_load_coef','M090SC90a_no_hade_load_coef','M090SC90e_no_hade_load_coef','M090SC90g_no_hade_load_coef','M090SC90d_no_hade_load_coef','M090SC90h_no_hade_load_coef'};
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = filename;

% filename = {'M090SC100g_no_hade'};
% outnames = {'_SA_4_0'};
% rjm_directory = {'M090SC100g_no_hade'};

%% Mt=0.79; M=0.90; changing s/c;
% shorter list
% filename = {'RMCA0669a2','M09SC110','M09SC100c','M090SC090','M090SC080','M090SC070'};
% outnames = {'C5_SA_4','_SA_4_0','S4_SA_4','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'RMCA0669a2','M09SC110','M09SC100c','M090SC090','M090SC080','M090SC070'};

% filename = {'M090SC70_s_c_no_hade','M090SC80_s_c_no_hade','M090SC90_s_c_no_hade','M090SC100_s_c_no_hade','M090SC110_s_c_no_hade','M090SC120_s_c_no_hade'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M090SC70_s_c_no_hade','M090SC80_s_c_no_hade','M090SC90_s_c_no_hade','M090SC100_s_c_no_hade','M090SC110_s_c_no_hade','M090SC120_s_c_no_hade'};
%
% %% M090SC100_thickness 2%
% filename = {'M090SC100j_no_hade_load_coef_2%','M090SC100i_no_hade_load_coef_2%','M090SC100a_no_hade_load_coef_2%','M090SC100e_no_hade_load_coef_2%','M090SC100g_no_hade_load_coef_2%','M090SC100d_no_hade_load_coef_2%','M090SC100h_no_hade_load_coef_2%'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% outnames = [ outnames outnames ];
% rjm_directory = filename;
%
% %% M090SC100 thickness 3%
% filename = {'M090SC100j_no_hade_load_coef_3%','M090SC100i_no_hade_load_coef_3%','M090SC100a_no_hade_load_coef_3%','M090SC100e_no_hade_load_coef_3%','M090SC100g_no_hade_load_coef_3%','M090SC100d_no_hade_load_coef_3%','M090SC100h_no_hade_load_coef_3%','M090SC100j_no_hade3_3%','M090SC100j_no_hade4_3%','M090SC100g_no_hade2_3%','M090SC100g_no_hade3_3%','M090SC100l_no_hade_3%','M090SC100m_no_hade_3%','M090SC100n_no_hade_3%','M090SC100p_no_hade_3%'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% outnames = [ outnames outnames ];
% rjm_directory = filename;
% %%
%
% %% M090SC100 A98%
% filename = {'M090SC100j_no_hade_load_coef_A98%','M090SC100i_no_hade_load_coef_A98%','M090SC100a_no_hade_load_coef_A98%','M090SC100e_no_hade_load_coef_A98%','M090SC100g_no_hade_load_coef_A98%','M090SC100d_no_hade_load_coef_A98%','M090SC100h_no_hade_load_coef_A98%','M090SC100j_no_hade3_A98%','M090SC100j_no_hade4_A98%','M090SC100g_no_hade2_A98%','M090SC100g_no_hade3_A98%','M090SC100l_no_hade_A98%','M090SC100m_no_hade_A98%','M090SC100n_no_hade_A98%','M090SC100p_no_hade_A98%'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = filename;

filename = {'M090SC100d_no_hade'};
outnames = {'_SA_4_0'};
rjm_directory = filename;

%% M090SC080
% filename = {'M090SC80j_no_hade_load_coef','M090SC80i_no_hade_load_coef','M090SC80a_no_hade_load_coef','M090SC80e_no_hade_load_coef','M090SC80g_no_hade_load_coef','M090SC80d_no_hade_load_coef','M090SC80h_no_hade_load_coef','M090SC80j_no_hade3','M090SC80j_no_hade4','M090SC80g_no_hade2','M090SC80g_no_hade3','M090SC80l_no_hade'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% outnames = [ outnames outnames ];
% % filename = [ filename {'M090SC80_70_no_hade','M090SC80_80_no_hade','M090SC80_90_no_hade','M090SC80_80_no_hade','M090SC80_110_no_hade'}];
% rjm_directory = filename;
%%
%% inlet Mach = 0.65;
filename = {'M065SC75j_no_hade','M065SC75i_no_hade','M065SC75a_no_hade','M065SC75e_no_hade','M065SC75g_no_hade'};
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};

%% inlet Mach = 1.10
filename = {'M110SC90j_no_hade','M110SC90i_no_hade','M110SC90l_no_hade','M110SC90m_no_hade','M110SC90n_no_hade'} ;
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = {'M110SC90j_no_hade','M110SC90i_no_hade','M110SC90l_no_hade','M110SC90m_no_hade','M110SC90n_no_hade'};

filename = {'M110bSC90j_no_hade','M110bSC90i_no_hade','M110bSC90l_no_hade','M110bSC90m_no_hade','M110bSC90n_no_hade'} ;
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = {'M110bSC90j_no_hade','M110bSC90i_no_hade','M110bSC90l_no_hade','M110bSC90m_no_hade','M110bSC90n_no_hade'};

% different camber distributions
filename = {'M110SC90a1_psi035DH070','M110SC90a2_psi035DH070','M110SC90a3_psi035DH070','M110SC90a4_psi035DH070','M110SC90a5_psi035DH070','M110SC90a6_psi035DH070','M110SC90a7_psi035DH070'} ;
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = {'M110SC90a1_psi035DH070','M110SC90a2_psi035DH070','M110SC90a3_psi035DH070','M110SC90a4_psi035DH070','M110SC90a5_psi035DH070','M110SC90a6_psi035DH070','M110SC90a7_psi035DH070'};

% filename = {'M110SC90a4_psi035DH070','M110SC90a5_psi035DH070'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = filename;

% % different inlet flow angles camber c3 deltakss/deltak = 0.001 s/c =0.80
% filename = {'M110SC80a3_psi035DH070','M110SC80b3_psi035DH070','M110SC80c3_psi035DH070'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M110SC80a3_psi035DH070','M110SC80b3_psi035DH070','M110SC80c3_psi035DH070'};
%
% % different inlet flow angles camber c2 deltakss/deltak = 0.10, s/c =0.8
% filename = {'M110SC90f2_psi035DH070','M110SC90b2_psi035DH070','M110SC90c2_psi035DH070','M110SC90d2_psi035DH070','M110SC90e2_psi035DH070'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M110SC90f2_psi035DH070','M110SC90b2_psi035DH070','M110SC90c2_psi035DH070','M110SC90d2_psi035DH070','M110SC90e2_psi035DH070'};
% %
% filename = {'M110SC90a3_psi035DH070'};
% outnames = {'_SA_4_0'};
% rjm_directory = {'M110SC90a3_psi035DH070'};

% % 53 degrees joint location a3
% filename = {'M110SC90a3_psi035DH070_joint5','M110SC90a3_psi035DH070_joint1','M110SC90a3_psi035DH070_joint6'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M110SC90a3_psi035DH070_joint5','M110SC90a3_psi035DH070_joint1','M110SC90a3_psi035DH070_joint6'};
%
%
% % % different inlet flow angles camber c2 deltakss/deltak = 0.20, s_c=0.90;
% % filename = {'M110SC90b1_psi035DH070','M110SC90c1_psi035DH070'};
% % outnames = {'_SA_4_0','_SA_4_0','_SA_4_0'};
% % rjm_directory = {'M110SC90b1_psi035DH070','M110SC90c1_psi035DH070'};
%
% % % % 60 degree angle different cambers
% filename = {'M110SC90c1_psi035DH070','M110SC90c2_psi035DH070','M110SC90c3_psi035DH070','M110SC90c5_psi035DH070'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M110SC90c1_psi035DH070','M110SC90c2_psi035DH070','M110SC90c3_psi035DH070','M110SC90c5_psi035DH070'};
% %
% % % % 60 degree angle different cambers (load_coef = 0.40)
% filename = {'M110SC90c1_psi040DH070','M110SC90c2_psi040DH070','M110SC90c3_psi040DH070','M110SC90c5_psi040DH070'};
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M110SC90c1_psi040DH070','M110SC90c2_psi040DH070','M110SC90c3_psi040DH070','M110SC90c5_psi040DH070'};

%% supersonic select load_coef = 0.35, DH = 0.70
% filename = {'M105bSC90i_no_hade','M110eSC90l_no_hade','M120SC90n_no_hade','M130bSC90m_no_hade'} ;
% outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
% rjm_directory = {'M105bSC90m_no_hade','M110eSC90l_no_hade','M120SC90n_no_hade','M130bSC90l_no_hade'};


% filename = {'M110bSC90i_no_hade'};
% outnames = {'_SA_4_0'};
% rjm_directory = {'M110bSC90i_no_hade'};

% %Different proportions of supersonic camber: M = 1.20 & 60 degree angle different cambers thickness = 2.0%  dH=0.7 & Ax2/Ax1=0.90 & alpha_inlet=0 & s/c=0.90 & np =0.92
filename = {'M120SC90a1_psi035DH070et3','M120SC90a2_psi035DH070et3','M120SC90a3_psi035DH070et3','M120SC90a4_psi035DH070et3','M120SC90a5_psi035DH070et3','M120SC90a6_psi035DH070et3'};
outnames = {'_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0','_SA_4_0'};
rjm_directory = filename;


% filename = {'M120SC90a4_psi035DH070et3'};
% outnames = {'_SA_4_0'};
% rjm_directory = filename'
% M = 1.1;
% Ax = 1;
%
filename = {'M120SC90c5_psi035DH070et2b'};
outnames = {'_SA_4_0'};
rjm_directory = filename;


% thick = [0.08 0.07 0.06 0.05 0.04 0.03 0.02 0.015];
thick = [0.05 0.04 0.03 0.02 0.015];

% thick_name = {'t2','t5','t6b','t6','t7','t3','t2b','t1'};
thick_name = {'t6','t7','t3','t2b','t1'};

Minlet_sweep = [1.05, 1.15, 1.25,  1.3];

Minlet = [1.3];

alpha_inlet = [45, 50, 55, 60, 65];
alpha_inlet = [60];

alpha_name = {'c'};

perc_cam = [0.001 -0.05 -0.1 -0.15 -0.2];
camber_name = {'5','6','7','8','9'};

perc_cam = [0.25 0.2 0.15 0.1 0.05 0.001 -0.05 -0.1 -0.15 -0.2 -0.25];
camber_name = {'0' '1' '2' '3','4','5','6','7','8','9','10'};

% perc_cam = [0.25 0.2 0.15 0.1 0.05 0.001 -0.05 -0.1];
% camber_name = {'0' '1' '2' '3','4','5','6','7'};
%
% perc_cam = [0.45 0.40 0.35 0.30 0.25 0.2 0.15 0.1 0.05 0.001 -0.05 -0.1];
% camber_name = {'4b' '3b' '2b' '1b' '0b' '1' '2' '3','4','5','6','7'};


% perc_cam = [0.001 -0.05 -0.1 -0.15 -0.2];
% camber_name = {'5','6','7','8','9'};

% perc_cam = [-0.05 -0.1 -0.15 ];
% camber_name = {'6','7','8'};


% perc_cam = [-0.075 -0.10];
% camber_name = {'6b','7b'};
%
% perc_cam = [-0.20 -0.15 -0.10 -0.05];
% camber_name = {'9c','8c','7c','6c'};

s_c_target = [0.90];

deHaller = [0.65 0.675];

% set exit airflow angle
% alpha_tar = job.f.Alpha2

%% ******** Everything above is not necessary (kept for history)********

%% figure linestyle and color details details

color = [0,0,1;1,0,0;0,0.5,0;1,0,1;0.5,0,0.5;0.5,0.5,0.5;0,0,0;0.25,0.25,0.25;0,0,0;0,0,0;0,0,0;0,0,0;0,0,0;0,0,0;0,0,0;0,0,0];
Linestyle = {'-','--',':','-.','-','-','-','-','-','-'};
plot_stuff_iteration = 0; % if you want to plot iterations
if plot_stuff_iteration == 1
    n = figure();
end

clear sweep chi_le_guess job

%% set thickness details used as datum

% choose blade you want to derive thickness from
blade_name = 'XWB84k_IPC_R1';
blade_name = 'TEN_I02R';
load(['/mnt/Disk1/dl467/Documents/Blades_parameterised/' blade_name '.mat']);
% choose non-dimensional section you want to take thickness from
r_nondim = 0.80;
thick_names = {'rad_le','s_thick_max','rad_thick_max','wedge_te','thick_te','thick_max','tchord'};
cam_names = {'chi_le','chi_te','perc_cam','pitch_chord','knot_coef','qcam','dcam_le','dcam_te'};
cam_spline = 1;
c = bl_spline_eval(t,r_nondim,cam_spline);
for v = 1:length(thick_names)
    job.(thick_names{v}) = c.(thick_names{v});
end
for v = 1:length(cam_names)
    job.(cam_names{v}) = c.(cam_names{v});
end
% just used if you want to check datum blade section used for thickness
dev=[]; ote = 1; plot_stuff = 0; cam_spline = 1;
%% USER defined job.knot_coef
job.knot_coef = [1.0000    1.0000    1.0000    1.0000    1.0000    0.8000    0.5000    1.0000];
%%
[xrt,xrt_cam,xrt_ps,xrt_ss]=bl_construct_section(job,plot_stuff,ote,dev,cam_spline);

%% set datum radius and chord for mises (just used for reference)

job.r_mid = 0.2677;
job.r_le = 0.2677;
job.r_te = 0.2677;

job.tchord = 0.05;

%% air properties
ga = 1.4;
R = 287;

%% datum blade design

t_c_dat = 3/100;
s_c_dat = 0.90;
N_dat= round((2*pi*job.r_mid./job.tchord)./s_c_dat);

alpha_rel_inlet_dat = 65;
alpha_inlet_dat = 0;
M_inlet_dat = 1.10;

np = 0.95;
load_coef_dat = 0.35;
Ax_dat = 1.0;
% Axt = 1.0;
% Ax = 0.95;
dH_dat = 0.66;
mode = 2; % mode 1: constant psi & dh; mode 2: contant psi & Area ratio; mode 3: constnat dH and Area ratio ; mode 4: constant dH and throat area ratio


%% define sweep variables
sweep.t_c = [4 3 2 5 6]/100;
sweep.Axt = [0.975 0.99 1.025 1.0 1.01 0.95 1.05];
sweep.Ax = [1.05 0.95 0.975 1.025 0.90];
sweep.load_coef = [0.40 0.35 0.30 0.45 0.50];
sweep.alpha_rel_inlet = [45 50 55 60 65];
sweep.s_c = [0.50 0.60 0.70 0.80 0.90 1.0];

% extract variable that will be swept
var = fieldnames(sweep);

%% set local incidence target
job.psi_target = 0;


disp(['*** sweeping: '])
var

%%
for k = 1:length(var)
    
    disp(['*** sweeping: ' var{k} ' ****'])
    % remove before each sweep
    if isfield(job,'Axt') == 1
        job=rmfield(job,'Axt');
    end
    
    for m = 1:length(sweep.(var{k}))
        
        
        % sweep through different perecentage cambers
        %     perc_cam = [0.10 0.05 0.001 -0.05 -0.1 -0.15 -0.20 -0.25 -0.30 -0.40];
        perc_cam = [0.40 0.30 0.20 0.10 0.001 -0.1 -0.20 -0.30 ];
        for i = 1:length(perc_cam)

            job.perc_cam = perc_cam(i);
            clear chi_te local_inc loss dchi_te_sort i_sort chi_le
            chi_te = [];
            
            if strcmp(var{k},'s_c')==1
                s_c = sweep.s_c(m);
                job.N = round((2*pi*0.5*(job.r_le +job.r_te)./job.tchord)./s_c);
            else
                s_c = s_c_dat;
                job.N = N_dat;
            end
            
            if strcmp(var{k},'t_c')==1
                job.thick_max = sweep.t_c(m).*job.tchord;
                t_c = sweep.t_c(m);
            else
                job.thick_max = t_c_dat.*job.tchord;
                t_c = t_c_dat;
            end
            
            %% change inlet flow angle (or U/cpTo1) and Mach number
            if strcmp(var{k},'alpha_rel_inlet')==1
                job.alpha_rel_inlet = sweep.alpha_rel_inlet(m);
                if exist('chi_le_guess','var')==0 || isempty(chi_le_guess)==0
                    % initial guess
                    job.chi_le = sweep.alpha_rel_inlet(m)-2.5;
                else % use previous solution as a better initial guess
                    job.chi_le = chi_le_guess;
                    disp(['Guess for inlet cam ' num2str(chi_le_guess)])
                end
            else
                job.alpha_rel_inlet = alpha_rel_inlet_dat;
                
                if exist('chi_le_guess','var')==0 || isempty(chi_le_guess)==0
                    % initial guess
                    job.chi_le = job.alpha_rel_inlet-2.5;
                else % use previous solution as a better initial guess
                    job.chi_le = chi_le_guess;
                    disp(['Guess for inlet cam ' num2str(chi_le_guess)])
                end
            end
            
            if strcmp(var{k},'alpha_inlet')==1
                job.alpha_inlet = sweep.alpha_inlet(m);
            else
                job.alpha_inlet = alpha_inlet_dat;
            end
            
            if strcmp(var{k},'M_inlet')==1
                job.Mrel_inlet = sweep.M_inlet(m);
            else
                job.Mrel_inlet = M_inlet_dat;
            end
            
            %% set polytropic efficiency
            job.np = np;
            
            %% change aeroparameters
            if strcmp(var{k},'load_coef')==1
                job.load_coef = sweep.load_coef(m);
            else
                job.load_coef = load_coef_dat;
            end
            if strcmp(var{k},'dH')==1
                job.DeHaller = sweep.dH(m);
            else
                job.DeHaller = dH_dat;
            end
            
            %% change streamtube contraction
            if strcmp(var{k},'Ax')==1
                job.f.Ax = sweep.Ax(m);
            else
                job.f.Ax = Ax_dat;
            end
            
            %% change streamtube contraction
            if strcmp(var{k},'Axt')==1
                job.Axt = sweep.Axt(m);
%             else
%                 job.Axt = Axt;
            end
            
            %% calculate exit Mach number and flow angle
            [f]=mises_output_finput(job,mode);
            job.f = f;
            job.f.M = job.Mrel_inlet;
            
            
            %% set target exit flow angle and chi_te initial value
            % set exit airflow angle
            alpha_tar = job.f.Alpha2;
            % first guess for exit flow blade metal angle
            job.init = -1;
            job.chi_te = job.f.Alpha2 + job.init;
            job.chi_te_temp = job.chi_te;
            
            
            %% Name new directory
            if mode  == 1
                ext = ['_psi0' num2str(100*job.load_coef) 'DH0'  num2str(100*job.DeHaller)];
            elseif mode  == 2
                if isfield(job,'Axt') == 0
                    ext = ['_psi0' num2str(100*job.load_coef) 'A' num2str(round(100*job.f.Ax))];
                else
                    ext = ['_psi0' num2str(100*job.load_coef) 'Axt' num2str(round(100*job.Axt)) 'A' num2str(round(100*job.f.Ax))];
                end
            elseif mode == 3
                ext = ['_DH0' num2str(100*job.DeHaller) 'A' num2str(round(100*job.f.Ax))];
            elseif mode == 4
                ext = ['_DH0' num2str(100*job.DeHaller) 'Axt' num2str(round(100*job.f.Ax))];
            end
            directory = ['/mnt/Disk1/dl467/Documents/Test_Cases/M' num2str(round(100*job.Mrel_inlet)) 'A' num2str(round(100*job.alpha_rel_inlet)/100) 'SC' num2str(round(100*s_c)) 'TC' num2str(round(100*t_c)) 'PC' num2str(round(100*job.perc_cam)) ext '/MISES/'];
            job.directory = directory;
            job.rjm_directory = directory;
            mis_directory = strrep(directory,'TURBOSTREAM','MISES');
            
            % conditions to start iteration
            if exist(directory,'dir') == 0 % check if diercotry exists
                mkdir(directory);
                disp([directory ': does not exist: Run'])
                start = 1;
            else
                [p,h] = mis_plot_section(directory,[],[0,0,1],0,job);
                if isempty(p) == 0 % already has converged solution
                    load([directory 'job.mat'])
                    if isfield(job,'conv')==0
                        start = 0;
                        disp([directory ': Solution produced an unexpected error; diagnose and run again'])
                    else
                        disp([directory ': solution already exists'])
                        start = 0;
                        [Polarx, Ises] = mis_read_polarx('mises',directory);
                    end
                    %% CHECK - NOT SURE IF RELEVANT OR IF EXIT MACH NUMBER IS KEY
                    if size(Polarx.sout,2) == 1
                        [p,h] = mis_plot_section(job.rjm_directory,[],[0,0,1],0,job);
                    else
                        [~,i_des] = min(abs(Polarx.binl-(Ises.binl)));
                        Polarx.sout = Polarx.sout(i_des);
                    end
                    delta_alpha = atand( Polarx.sout ) - alpha_tar;
                    if abs(delta_alpha) > 0.5
                        disp(['****** Run again difference between target and true exit flow angle: ' num2str(delta_alpha) ' degrees *****'])
                        start = 0;
                    end
                    
                else
                    load([directory 'job_init.mat']);
                    if job.initial_sol == 0
                        start = 0; % initial solution has run and not converged skip
                        disp([directory ': initial solution failed to converge'])
                        job.init = -1.5;
                        job.chi_te = job.f.Alpha2 + job.init;
                        job.chi_le = job.alpha_rel_inlet-2.0;
                        %%
                    else
                        load([directory 'job.mat']);
                        if length(job.chi_te_dummy)~=1 && job.conv == 1 && isfield(job,'rerun')==0
                            start = 0;
                            disp([directory ': has not been able to converge at optimised point'])
                            loss_loop = [1.05, 1.025, 1.075]; % losses relative to minimum to run at
                            for l = 1:length(loss_loop)
                                disp(['****Re-run at a ' num2str(round(100*(loss_loop(l)-1))) '% higher loss*****'])
                                job.chi_te_dummy = job.chi_te_dummy(isnan(job.loss_dummy)==0);
                                job.chi_le_dummy = job.chi_le_dummy(isnan(job.loss_dummy)==0);
                                job.loss_dummy = job.loss_dummy(isnan(job.loss_dummy)==0);
                                job.chi_te = interp1(job.loss_dummy./min(job.loss_dummy),job.chi_te_dummy,loss_loop(l));
                                job.chi_le = interp1(job.loss_dummy./min(job.loss_dummy),job.chi_le_dummy,loss_loop(l));
                                tot_cam = job.chi_le - job.chi_te;
                                disp(['*****Total camber is: ' num2str(tot_cam) ' ******'])
                                if isnan(tot_cam) == 1
                                    continue
                                end
                                run_single = 0; % run loss loop
                                [q,h,job] =  mis_run_section_ss(directory,[],[0,0,1],0,1,run_single,job);
                                [p,h] = mis_plot_section(directory,h,color(i,:),0,job);
                                if isempty(p) == 0
                                    job.conv = 1;
                                    save([directory 'job.mat'],'job')
                                    break
                                else
                                    disp('**** Cound not run at slightly more loss ****')
                                    job.rerun=1;
                                end
                            end
                        elseif job.conv == -1 && isfield(job,'rerun')==0
                            start = 0; % initial solution has run and not converged within iteration number limit
                            disp([directory ': Final solution not found within iteration number limit'])
                            if length(job.loss_dummy(isnan(job.loss_dummy)==0))==1
                                disp('**** Only one point cannot interpolate ****')
                            else    
                            loss_loop = [1.01 1.025, 1.05, 1.075]; % losses relative to minimum to run at
                            for l = 1:length(loss_loop)
                                job.chi_te_dummy=job.chi_te_dummy(isnan(job.loss_dummy)==0);
                                job.chi_le_dummy=job.chi_le_dummy(isnan(job.loss_dummy)==0);
                                job.loss_dummy=job.loss_dummy(isnan(job.loss_dummy)==0);
                                disp(['****Re-run at a ' num2str(round(100*(loss_loop(l)-1))) '% higher loss*****'])
                                job.chi_te = interp1(job.loss_dummy./min(job.loss_dummy),job.chi_te_dummy,loss_loop(l));
                                job.chi_le = interp1(job.loss_dummy./min(job.loss_dummy),job.chi_le_dummy,loss_loop(l));
                                tot_cam = job.chi_le - job.chi_te;
                                disp(['*****Total camber is: ' num2str(tot_cam) ' ******'])
                                if isnan(tot_cam) == 1
                                    continue
                                end
                                run_single = 0; % run loss loop
                                [q,h,job] =  mis_run_section_ss(directory,[],[0,0,1],0,1,run_single,job);
                                [p,h] = mis_plot_section(directory,h,color(i,:),0,job);
                                if isempty(p) == 0
                                    job.conv = 1;
                                    save([directory 'job.mat'],'job')
                                    break
                                else
                                    disp('**** Cound not run at slightly more loss ****')
                                    job.rerun=1;
                                end
                            end
                            end
                        elseif job.conv == 0 
                            disp([directory ': Limit in change in chi_te reached - ' num2str(job.beta_lim)])
                            start = 0;
                        else
                            disp('**** Could not go further than initial solution ****')
                            start = 0;
                        end
                    end
                end
                
            end
            
            if start == 1
                
                job.initial_sol = 1;
                if isfield(job,'loss_dummy') == 1
                    job=rmfield(job,'loss_dummy');
                end
                if isfield(job,'chi_te_dummy') == 1
                    job=rmfield(job,'chi_te_dummy');
                end
                if isfield(job,'chi_le_dummy') == 1
                    job=rmfield(job,'chi_le_dummy');
                end
                
                
                %% get initial value of inlet blade metal angle based on unique incidence condition if no previous solution exists
                if exist('chi_le_guess','var')==0
                    disp(['**** Calculating unique incidence angle.....  *****'])
                    [beta_i,M_s]=unique_incidence_detached_contr_MCA2(job,s_c*job.tchord,job.Mrel_inlet,[],0);
                    deltai = beta_i - job.chi_le;
                    job.deltai = deltai;
                    job.chi_le = job.alpha_rel_inlet - deltai;
                    chi_le = job.chi_le;
                    job.chi_le_init = job.chi_le;
                    disp(['**** From unique incidence Delta = ' num2str(deltai) ' *****'])
                else
                    job.chi_le = chi_le_guess; % use previous solutions or one set at the start
                    job.chi_le_init = job.chi_le;
                    disp('**** Inlet camber from previous solution *****')
                end
                
                %% run until you have correct guess for total camber sweep from -3 to +2 of total turning
                q.manual = 1;
                n_initial = 1;
                n_initial_max = 10;
                job.initial_sol = 1;
                job.chi_le_init = job.chi_le;
                while q.manual == 1 && n_initial < n_initial_max
                    [q,h,job] = mis_run_section_ss(directory,[],[0,0,1],0,1,1,job);
                    if q.manual == 1
                        tot_cam = job.chi_le - job.chi_te;
                        disp(['******Cannot run at this total camber ' num2str(tot_cam) ' ******'])
                        job.chi_le = job.chi_le_init; % reset chi-le in case it has gone rogue
                    end
                    job.dinit = -0.50;
                    job.chi_te = job.chi_te + job.dinit;
                    n_initial = n_initial + 1;
                end
                if n_initial >= n_initial_max
                    disp('***** Cannot run initial solution try again*****')
                    job.initial_sol=0;
                    save([directory 'job_init.mat'],'job')
                    continue
                end
                
                save([directory 'job_init.mat'],'job')
                save([directory 'job.mat'],'job')
                
                %% start design iterations if initial solution was found
                
                % iteration number
                ni = 1;
                n_max = 12;
                beta=1;
                beta_temp = beta;
                job.chi_te_temp = job.chi_te;
                job.chi_le_temp = job.chi_le;
                
                
                % set default dchi_te and beta_lim
                dchi_te = -1.0;
                job.dchi_te = dchi_te;
                beta_lim = 0.20; % minimum change in chi_te whn the iteration process tops
                job.beta_lim = beta_lim;
                
                [Polarx, Ises] = mis_read_polarx('mises',directory);
                if size(Polarx.sout,2) == 1
                    [p,h] = mis_plot_section(directory,[],[0,0,1],0,job);
                    P_ratio = Polarx.p2pt./Polarx.p1pt;
                else
                    [~,i_des] = min(abs(Polarx.binl-(Ises.binl)));
                    Polarx.sout = Polarx.sout(i_des);
                    Polarx.binl = Polarx.binl(i_des);
                    P_ratio = Polarx.p2pt(i_des)./Polarx.p1pt(i_des);
                end
                
                % get better guess for polytropic efficiency and hence exit
                % mach number triangle
                syms np_var
                np_new = vpasolve(P_ratio == (1+(ga-1)./2.*f.M.^2.*(1-job.DeHaller.^2))^(ga.*np_var./(ga-1)),np_var,[0,1])
                if isempty(np_new)==1
                    np_new =0.95;
                end
                job.np = double(np_new);
                [f]=mises_output_finput(job,mode);
                job.f = f;
                job.f.M = job.Mrel_inlet;
                
                % Read in the grid coodinates to determine local incidence
                if exist([directory 'idat.mises_01'],'file') ~= 0
                    Idat = mis_read_idat('mises_01',directory);
                else
                    Idat = mis_read_idat('mises',directory);
                end
                load([directory 'section.mat']);
                mt_stag = [Idat.x(Idat.ninl(2),end) Idat.y(Idat.ninl(2),end)];
                phi_stag = atan2(c.mt_le_cen(2) - mt_stag(2),c.mt_le_cen(1) - mt_stag(1)) * 360 / (2*pi);
                [p,h] = mis_plot_section(directory,[],[0,0,1],0,job);
                q.manual = 0;
                
                
                while ni<n_max && abs(beta) > beta_lim
                    
                    disp(['*****Iteration number ' num2str(ni)  '****']);
                    save([directory 'job_temp.mat'],'job');
                    load([directory 'section.mat']);
                    delta_alpha = atand( Polarx.sout ) - alpha_tar;
                    disp(['****** Difference between target and true exit flow angle: ' num2str(delta_alpha) ' degrees *****'])
                    
                    dchi_te_sort(ni,i) = dchi_te;
                    chi_le(ni,i) = job.chi_le;
                    
                    if q.manual == 0
                        chi_te(ni,i) = job.chi_te_temp;
                        local_inc(ni,i) = phi_stag-c.chi_le;
                        loss(ni,i) = Polarx.omega;
                    else
                        chi_te(ni,i) = job.chi_te_temp;
                        local_inc(ni,i) = 0;
                        loss(ni,i) = 0;
                    end
                    
                    
                    % sort by increasing camber
                    [chi_te(:,i),i_sort]=sort(chi_te(:,i),'descend');
                    local_inc(:,i) = local_inc(i_sort,i);
                    loss(:,i) = loss(i_sort,i);
                    chi_le(:,i) = chi_le(i_sort,i);
                    dchi_te_sort(:,i) = dchi_te_sort(i_sort,i);
                    
                    
                    
                    % In the case where beta is less or becomens negative (negative side of loop) than the initial value
                    % restart from the minimum loss point
                    if ni ~= 1 && beta~=beta_temp
                        
                        % Generate total cambers to interpolate
                        chi_te_dummy = chi_te(:,i);
                        chi_te_dummy(chi_te_dummy==0)=[];
                        [chi_te_dummy,i_unique] = unique(chi_te_dummy,'stable');
                        
                        chi_te_interp = [linspace(chi_te_dummy(1),chi_te_dummy(end),100)];
                        chi_te_interp = unique(chi_te_interp,'stable');
                        
                        loss_dummy = loss(:,i);
                        loss_check = loss_dummy;
                        loss_dummy(loss_dummy==0)=NaN;
                        loss_dummy = loss_dummy(i_unique);
                        
                        % Find the point previous to the min
                        [~,i_min] = min(loss_dummy); loss_min = double(loss_dummy(i_min));
                        i_current = find(loss_dummy <= loss_min.*1.005,1,'last');
                        i_current = min(i_current);
                        if isempty(i_current) == 1 % in case all of loss is NaNed
                           i_current = 1;
                        end
                        
                        dchi_te_dummy = dchi_te_sort(:,i);
                        dchi_te_dummy(dchi_te_dummy==0)=NaN;
                        dchi_te_dummy = dchi_te_dummy(i_unique);
                        
                        chi_le_dummy = chi_le(:,i);
                        chi_le_dummy = chi_le_dummy(i_unique);
                        
                        job.chi_te = chi_te_dummy(i_current);
                        chi_te_temp = chi_te_dummy(i_current);
                        loss_temp = loss_dummy(i_current);
                        dchi_te = dchi_te_dummy(i_current);
                        job.chi_le = chi_le_dummy(i_current);
                        
                        beta_temp = beta;
                        
                    elseif ni==1
                        loss_temp = loss(ni,i);
                        chi_te_temp = chi_te(ni,i);
                        chi_te_dummy = chi_te(:,i);
                        loss_dummy = loss(:,i);
                        dchi_te_dummy = dchi_te_sort(:,i);
                        chi_le_dummy = chi_le(:,i);
                    end
                    
                    job.chi_te_dummy = chi_te_dummy;
                    job.loss_dummy = loss_dummy;
                    job.local_inc_dummy = dchi_te_dummy;
                    job.chi_le_dummy = chi_le_dummy;
                    
                    save([directory 'job.mat'],'job')
                    
                    % increase the total camber and run
                    job.chi_te_temp = job.chi_te +  beta.*dchi_te;
                    
                    
                    % check if it has already run; continue to next point
                    while job.chi_te~=job.chi_te_temp
                        for l = 1:length(chi_te(:,i))
                            if chi_te(l,i) == job.chi_te_temp
                                job.chi_te_temp = job.chi_te_temp +  beta.*dchi_te;
                                break
                            elseif l==length(chi_te(:,i))
                                job.chi_te = job.chi_te_temp;
                            end
                        end
                    end
                    
                    save([directory 'job.mat'],'job');
                    % run new section
                    [q,h,job] = mis_run_section_ss(directory,[],[0,0,1],0,1,1,job);
                    
                    %% check if chi_te is not working change inlet blade metal angle (+/- 1 degree)
                    %% if this doesnt work change total camber increment and start again from minimum loss.
                    ni_bia_max = 5;
                    ni_bia = 1;
                    if q.manual == 1
                        job.chi_le = job.chi_le - 1;
                        while q.manual == 1 && ni_bia<=ni_bia_max
                            disp('****Cannot run at this total camber inlet blade metal angle changed****')
                            % 			job.chi_te = job.chi_te +  beta*dchi_te;
                            job.chi_le = job.chi_le + 0.40;
                            [q,h,~] = mis_run_section_ss(directory,[],[0,0,1],0,1,1,job);
                            ni_bia = ni_bia+1;
                        end
                        if q.manual ==1
                            disp('***** Reduce increment in total camber by half and restart from minimum loss (Cannot converge at this level of total camber) *******')
                            beta = 0.5*beta;
                            if ni == 1 % to keep initial solution logged
                                ni = ni + 1;
                            end
                            % bring inlet cam back to initial solution value
                            job.chi_le = job.chi_le_temp;
                            continue
                        end
                    end
                    
                    
                    %% save output values and blade parameters after run
                    
                    [Polarx, Ises] = mis_read_polarx('mises',directory);
                    
                    % get better guess for polytropic efficiency and exit
                    % mach number for next iteration
                    P_ratio = Polarx.p2pt./Polarx.p1pt;
                    syms np_var
                    np_new = vpasolve(P_ratio == (1+(ga-1)./2.*f.M.^2.*(1-job.DeHaller.^2))^(ga.*np_var./(ga-1)),np_var,[0,1])
                    job.np = double(np_new);
                    if isempty(np_new)==1
                        np_new =0.95;
                    end
                    [f]=mises_output_finput(job,mode);
                    job.f = f;
                    job.f.M = job.Mrel_inlet;
                    
                    [p,h] = mis_plot_section(job.rjm_directory,[],[0,0,1],0,job);
                    q.manual = 0;
                    bout = atand(Polarx.sout);
                    Idat = mis_read_idat('mises',directory);
                    load([directory 'section.mat']);
                    
                    mt_stag = [Idat.x(Idat.ninl(2),end) Idat.y(Idat.ninl(2),end)];
                    phi_stag = atan2(c.mt_le_cen(2) - mt_stag(2),c.mt_le_cen(1) - mt_stag(1)) * 360 / (2*pi);
                    
                    ni = ni+1;
                    chi_te(ni,i) = job.chi_te;
                    local_inc(ni,i) = phi_stag-c.chi_le;
                    loss(ni,i) = Polarx.omega;
                    chi_le(ni,i) = job.chi_le;
                    
                    
                    % Record pressure rise value and update next point
                    dloc_inc = local_inc(ni,i) - local_inc(ni-1); ni_current = length(local_inc(:,i));
                    dloss = loss(ni,i)-loss_temp;
                    loss_temp = loss(ni,i);
                    dchi_te = abs(chi_te(ni,i)-chi_te_temp);
                    
                    %% reduce change in camber if loss increases by more than 10% of minimum
                    loss_min = min(loss(:,i));
                    if loss(ni,1)/loss_min>1.15
                        %% Half the change in total camber
                        if beta > 0
                            disp('***** Loss 15% higher than minimum - start negative side *****')
                            beta = - beta;
                        elseif beta < 0
                            disp('***** Loss 15% higher than minimum on negative side*****')
                            break
                        end
                    end

                    %% ADJUST FRACTION chord
                    [job]=ts_frac_chord_mises(job);
                    
                end
                
                if ni>= n_max
                    disp('***Reached maximum number of iterations****');
                    job.conv = -1;
                elseif abs(beta) < beta_lim
                    disp('***Reached beta limit to change in total camber****');
                    job.conv = 0;
                else
                    disp('***Completed full sweep - now running minimum loss****');
                    job.conv =  1;
                end
                
                % sort by increasing camber
                [chi_te(:,i),i_sort]=sort(chi_te(:,i),'descend')
                local_inc(:,i) = local_inc(i_sort,i);
                loss(:,i) = loss(i_sort,i)
                chi_le(:,i) = chi_le(i_sort,i)
                
                dchi_te = beta.*(phi_stag-c.chi_le);
                if size(chi_te,1) > size(dchi_te_sort,1)
                    dchi_te_sort(ni,i) = dchi_te;
                end
                dchi_te_sort(:,i) = dchi_te_sort(i_sort,i);
                
                save([directory 'job.mat'],'job');
                
                %% run minimum loss incidence
                
                disp('***** Run minimum loss incidence .... ******')
                
                % Generate flow coefficient vector to interpolate
                chi_te_dummy = chi_te(:,i);
                loss_dummy = loss(:,i);
                chi_te_dummy(loss_dummy==0)=[];
                chi_te_interp = chi_te_dummy(1);
                [chi_te_dummy,i_unique] = unique(chi_te_dummy,'stable');
                
                chi_te_interp = [linspace(chi_te_interp,chi_te_dummy(end),100)];
                chi_te_interp = unique(chi_te_interp,'stable');
                
                loss_dummy(loss_dummy==0)=[];
                loss_dummy = loss_dummy(i_unique);
                % Spline all points
                if length(chi_te_interp) == 1
                    loss_interp = loss_dummy;
                else
                    loss_interp = interp1(chi_te_dummy,loss_dummy,chi_te_interp,'pchip');
                end
                
                dchi_te_dummy = dchi_te_sort(:,i);
                dchi_te_dummy(loss_dummy==0)=[];
                dchi_te_dummy = dchi_te_dummy(i_unique);
                
                chi_le_dummy = chi_le(:,i);
                chi_le_dummy(chi_le_dummy==0)=[];
                chi_le_dummy = chi_le_dummy(i_unique);
                
                % Find the point previous to the maximum
                [~,i_min] = min(loss_interp); loss_min = loss_interp(i_min);
                i_current = find(loss_dummy <= loss_min,1,'last');
                job.chi_te = chi_te_dummy(i_current);
                chi_te_temp = chi_te_dummy(i_current);
                loss_temp = loss_dummy(i_current);
                job.chi_le = chi_le_dummy(i_current);
                chi_le_temp = chi_le_dummy(i_current);
                
                
                job.chi_te_dummy = chi_te_dummy;
                job.loss_dummy = loss_dummy;
                job.local_inc_dummy = dchi_te_dummy;
                job.chi_le_dummy = chi_le_dummy;
                
                save([directory 'job.mat'],'job')
                run_single = 0; % run loss loop
                [q,h,job] = mis_run_section_ss(directory,[],[0,0,1],0,1,run_single,job);
                
                % new guess for inlet cam
                chi_le_guess = chi_le_temp;
                
                save([directory 'job.mat'],'job');
                
                %% make plot
                
                if plot_stuff_iteration == 1; % if you want to plot iterations
                    
                    figure(n); grid on; hold on;
                    chi_te_plot = chi_te(:,i);
                    local_inc_plot = local_inc(:,i);
                    chi_le_plot = chi_le(:,i);
                    local_inc_plot(local_inc_plot==0)=NaN;
                    chi_le_plot(chi_le_plot==0)=NaN;
                    loss_plot = loss(:,i);
                    loss_plot(loss_plot==0)=NaN;
                    [hAx,hLine1,hLine2]=plotyy(chi_le_plot-chi_te_plot,loss_plot,chi_le_plot-chi_te_plot,job.f.Alpha-chi_le_plot);
                    % 	ylabel('Local incidence \phi_{stag}-\chi_{le}')
                    xlabel('Total camber \chi_{le}-\chi_{te}')
                    ylabel(hAx(2),'Local incidence \phi_{stag}-\chi_{le}')
                    % 	ylabel(hAx(2),'H_{TE}')
                    ylabel(hAx(1),'Profile loss (Y_{p})')
                    hAx(1).YColor=[0 0 1];
                    hAx(2).YColor=[1,0,0];
                    
                    hLine1.Marker= 'x';
                    hLine1.Color=color(m,:);
                    hLine2.Marker= 'o';
                    hLine2.Color=color(m,:);
                    hLine1.LineWidth=1.1;
                    hLine2.LineWidth=1.1;
                    hLine2.LineStyle='--';
                    
                end
                
            end
            
        end
    end
    
end
